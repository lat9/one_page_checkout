// -----
// Part of the One-Page Checkout plugin, provided under GPL 2.0 license by lat9.
// Copyright (C) 2013-2024, Vinos de Frutas Tropicales.  All rights reserved.
//
// Last changed: OPC v2.5.0
//
var selected,submitter=null;function concatExpiresFields(e){return jQuery(":input[name="+e[0]+"]").val()+jQuery(":input[name="+e[1]+"]").val()}function popupWindow(e){window.open(e,"popupWindow","toolbar=no,location=no,directories=no,status=no,menubar=no,scrollbars=yes,resizable=yes,copyhistory=no,width=450,height=320,screenX=150,screenY=150,top=150,left=150")}function couponpopupWindow(e){window.open(e,"couponpopupWindow","toolbar=no,location=no,directories=no,status=no,menubar=no,scrollbars=yes,resizable=yes,copyhistory=no,width=450,height=320,screenX=150,screenY=150,top=150,left=150")}function submitonce(){var e=document.getElementById("btn_submit");return e.style.cursor="wait",e.disabled=!0,setTimeout("button_timeout()",shippingTimeout),!1}function button_timeout(){var e=document.getElementById("btn_submit");e.style.cursor="pointer",e.disabled=!1}function zcLog2Console(e){window.console&&"function"==typeof console.log&&console.log(e)}function methodSelect(e){document.getElementById(e)&&(document.getElementById(e).checked="checked")}function setJavaScriptEnabled(){var e=document.getElementById("javascript-enabled");e&&(e.value="1")}var orderConfirmed=0;function setOrderConfirmed(e){orderConfirmed=e,jQuery("#confirm-the-order").val(e),zcLog2Console("Setting orderConfirmed ("+e+"), submitter ("+submitter+")")}jQuery(document).ready(function(){var e=!1;0==jQuery('form[name="checkout_payment"]').length&&(e=!0,zcLog2Console('Missing form[name="checkout_payment"]')),0==jQuery("#orderTotalDivs").length&&(e=!0,zcLog2Console("Missing #orderTotalDivs"));var o=shippingChoiceAvailable&&paymentChoiceAvailable;function t(){jQuery("#checkoutOneShipto").length&&(jQuery("#shipping_billing").is(":checked")?(jQuery("#checkoutOneShipto").hide(),jQuery("#opc-billing-title").text(billingShippingTitle)):(jQuery("#checkoutOneShipto").show(),jQuery("#opc-billing-title").text(billingTitle)))}displayShippingBlock||(o=!1,jQuery("#checkoutShippingMethod").hide(),jQuery("#otshipping").hide(),jQuery("#otshipping+br").hide()),displayPaymentBlock||(o=!1,jQuery("#checkoutPaymentMethod").hide()),o&&(0==jQuery("#current-order-total").length&&(e=!0,zcLog2Console("Missing #current-order-total")),0==jQuery("#opc-order-confirm").length&&(e=!0,zcLog2Console("Missing #opc-order-confirm")),0==jQuery("#opc-order-review").length&&(e=!0,zcLog2Console("Missing #opc-order-review")),0==jQuery(ottotalSelector).length&&(e=!0,zcLog2Console("Missing "+ottotalSelector))),!virtual_order&&o&&0==jQuery("#otshipping").length&&(e=!0,zcLog2Console("Missing #otshipping")),e&&alert("Please contact the store owner; some required elements of this page are missing."),t(),setJavaScriptEnabled(),zcJS.ajax({url:"ajax.php?act=ajaxOnePageCheckout&method=getOrderTotal",timeout:shippingTimeout,error:function(e,o,t){zcLog2Console("error: status="+o+", errorThrown = "+t+", override: "+e),"timeout"==o&&alert(ajaxTimeoutShippingErrorMessage),shippingError=!0}}).done(function(e){c(e),jQuery("#current-order-total").val(e.total)}),jQuery(document).on("keypress",":input:not(textarea)",function(e){return 13!=e.keyCode});var n=!1;function r(){var e=null;if(document.checkout_payment.payment)if(document.checkout_payment.payment.length)for(var o=0;o<document.checkout_payment.payment.length;o++)document.checkout_payment.payment[o].checked&&(e=document.checkout_payment.payment[o].value);else(document.checkout_payment.payment.checked||document.checkout_payment.payment.value)&&(e=document.checkout_payment.payment.value);zcLog2Console("setFormSubmitButton, payment-module: "+e),jQuery("#opc-order-review, #opc-order-confirm").hide(),null==e||-1==confirmation_required.indexOf(e)?(jQuery("#opc-order-confirm").show(),zcLog2Console('Showing "confirm", paymentMethodHandlesSubmit ('+(n=null!=e&&-1!=paymentsThatSubmit.indexOf(e))+")")):(jQuery("#opc-order-review").show(),zcLog2Console('Showing "review"')),0!=jQuery("#privacy").length&&!jQuery("#privacy").is(":checked")||0!=jQuery("#conditions").length&&!jQuery("#conditions").is(":checked")?(zcLog2Console("setFormSubmitButton, disabling Review and Confirm buttons."),jQuery("#checkoutOneSubmit").addClass("opc-disabled")):(zcLog2Console("setFormSubmitButton, enabling Review and Confirm buttons."),jQuery("#checkoutOneSubmit").removeClass("opc-disabled"))}r(),jQuery(document).on("change","#privacy, #conditions",function(){r()}),setOrderConfirmed(0),jQuery("#checkoutOneShippingFlag").show(),zcLog2Console("jQuery version: "+jQuery().jquery),submitFunction=function(e,o){submitter=o<=e?1:null,zcLog2Console("submitFunction, on exit submitter="+submitter)};var i=null;function c(e){"timeout"===e.status&&(alert(sessionTimeoutErrorMessage),window.location.replace(timeoutUrl)),"unavailable"===e.status&&(alert(ajaxNotAvailableMessage),window.location.replace(checkoutShippingUrl)),"reload"===e.status&&(0!==e.errorMessage.length&&alert(e.errorMessage),window.location.reload(!0))}function u(e){var o;submitFunction(jQuery("input[name=cot_gv]").val(),jQuery("#current-order-total").val()),setOrderConfirmed(1),zcLog2Console("Form being submitted, submit_type("+e),jQuery("#confirm-the-order").attr("disabled",!0),flagOnSubmit&&(zcLog2Console("Form checked, passed ("+(o=check_form())+")"),o&&("confirm"===e&&(jQuery("*").css("cursor","wait"),jQuery("#checkoutPayment > .opc-overlay").addClass("active"),jQuery("#opc-order-confirm").attr("disabled",!0)),jQuery("#confirm-the-order").attr("disabled",!1),1==n?zcLog2Console("Deferring form submittal to the currently-selected payment method."):jQuery('form[name="checkout_payment"]').submit()))}function a(e,o){zcLog2Console("useSelectedAddress("+e+", "+o+")"),jQuery("#checkoutPayment > .opc-overlay").addClass("active"),zcJS.ajax({url:"ajax.php?act=ajaxOnePageCheckout&method=setAddressFromSavedSelections",data:{which:e,address_id:o,shipping_is_billing:jQuery("#shipping_billing").is(":checked")},timeout:shippingTimeout,error:function(e,o,t){zcLog2Console("error: status="+o+", errorThrown = "+t+", override: "+e),"timeout"==o&&alert(ajaxTimeoutSetAddressErrorMessage)}}).done(function(e){location.reload()})}function s(e){jQuery("#address-form-bill").is(":visible")&&(jQuery(this).addClass("opc-changed"),jQuery("#checkoutOneBillto .opc-buttons, #opc-bill-save, #opc-add-bill, #opc-add-bill+label").show(),jQuery("#opc-bill-edit").hide(),jQuery("#checkoutPayment > .opc-overlay").addClass("active"),jQuery("#checkoutOneGuestInfo, #checkoutOneBillto").addClass("opc-view"))}function l(){jQuery("#checkoutOneGuestInfo").length?(zcLog2Console("restoreCustomerInfo, starts ..."),zcJS.ajax({url:"ajax.php?act=ajaxOnePageCheckout&method=restoreCustomerInfo",timeout:shippingTimeout,error:function(e,o,t){zcLog2Console("error: status="+o+", errorThrown = "+t+", override: "+e),"timeout"==o&&alert(ajaxTimeoutRestoreCustomerErrorMessage)}}).done(function(e){c(e),jQuery("#checkoutOneGuestInfo").html(e.infoHtml),y("bill","#checkoutOneBillto")})):y("bill","#checkoutOneBillto"),jQuery("#checkoutPayment > .opc-overlay").removeClass("active"),jQuery("#checkoutOneGuestInfo, #checkoutOneBillto").removeClass("opc-view"),jQuery("#checkoutOneBillto .opc-buttons").hide()}function d(){jQuery("#checkoutOneGuestInfo").length?(zcLog2Console("saveCustomerInfo, starts ..."),zcJS.ajax({url:"ajax.php?act=ajaxOnePageCheckout&method=validateCustomerInfo",data:jQuery("#checkoutOneGuestInfo input, #checkoutOneGuestInfo select").serialize(),timeout:shippingTimeout,error:function(e,o,t){zcLog2Console("error: status="+o+", errorThrown = "+t+", override: "+e),"timeout"==o&&alert(ajaxTimeoutValidateCustomerErrorMessage)}}).done(function(e){c(e);var t,n="#messages-guest";0!=e.messages.length?(t=!1,jQuery(n).html("<ul></ul>").addClass("opc-error"),jQuery("#checkoutOneGuestInfo input").removeClass("opc-error"),jQuery.each(e.messages,function(e,o){jQuery(n+" ul").append("<li>"+o+"</li>"),jQuery('input[name="'+e+'"]').length&&(jQuery('input[name="'+e+'"]').addClass("opc-error").removeClass("opc-changed"),t||(t=!0,jQuery('input[name="'+e+'"]').focus()))})):j("bill","#checkoutOneBillto")})):j("bill","#checkoutOneBillto")}function p(e){jQuery("#address-form-ship").is(":visible")&&(jQuery(this).addClass("opc-changed"),jQuery("#checkoutOneShipto .opc-buttons, #opc-ship-save, #opc-add-ship, #opc-add-ship+label").show(),jQuery("#checkoutPayment > .opc-overlay").addClass("active"),jQuery("#checkoutOneShipto").removeClass("visibleField"),jQuery("#checkoutOneShipto").addClass("opc-view"))}function h(){y("ship","#checkoutOneShipto"),jQuery("#checkoutPayment > .opc-overlay").removeClass("active"),jQuery("#checkoutOneShipto").removeClass("opc-view"),jQuery("#checkoutOneShipto .opc-buttons").hide()}function m(){j("ship","#checkoutOneShipto")}function y(o,t){zcLog2Console("restoreAddressValues("+o+", "+t+")"),zcJS.ajax({url:"ajax.php?act=ajaxOnePageCheckout&method=restoreAddressValues",data:{which:o},timeout:shippingTimeout,error:function(e,o,t){zcLog2Console("error: status="+o+", errorThrown = "+t+", override: "+e),"timeout"==o&&alert(ajaxTimeoutRestoreAddressErrorMessage)}}).done(function(e){c(e),jQuery(t).replaceWith(e.addressHtml),"undefined"!=typeof initializeStateZones&&initializeStateZones(),"ship"==o?(jQuery(document).on("change","#checkoutOneShipto input, #checkoutOneShipto select:not(#select-address-ship)",p),jQuery(document).on("click","#opc-ship-cancel",h),jQuery(document).on("click","#opc-ship-save",m)):(jQuery(document).on("change","#checkoutOneBillto input, #checkoutOneBillto select:not(#select-address-bill)",s),jQuery(document).on("click","#opc-bill-cancel",l),jQuery(document).on("click","#opc-bill-save",d))})}function j(r,o){zcLog2Console("saveAddressValues("+r+", "+o+")"),zcJS.ajax({url:"ajax.php?act=ajaxOnePageCheckout&method=validateAddressValues",data:{which:r,gender:jQuery('input[name="gender['+r+']"]:checked').val(),company:jQuery('input[name="company['+r+']"]').val(),firstname:jQuery('input[name="firstname['+r+']"]').val(),lastname:jQuery('input[name="lastname['+r+']"]').val(),street_address:jQuery('input[name="street_address['+r+']"]').val(),suburb:jQuery('input[name="suburb['+r+']"]').val(),city:jQuery('input[name="city['+r+']"]').val(),state:jQuery('input[name="state['+r+']"]').val(),zone_id:jQuery('select[name="zone_id['+r+']"] option:selected').val(),postcode:jQuery('input[name="postcode['+r+']"]').val(),zone_country_id:jQuery('select[name="zone_country_id['+r+']"] option:selected').val(),shipping_billing:jQuery("#shipping_billing").is(":checked"),add_address:jQuery("#opc-add-"+r).prop("checked")},timeout:shippingTimeout,error:function(e,o,t){zcLog2Console("error: status="+o+", errorThrown = "+t+", override: "+e),"timeout"==o&&alert(ajaxTimeoutValidateAddressErrorMessage)}}).done(function(e){c(e);var t,n="#messages-"+r;0!=e.messages.length?(t=!1,jQuery(n).html("<ul></ul>").addClass("opc-error"),jQuery(o+" input, "+o+" select").removeClass("opc-error"),jQuery.each(e.messages,function(e,o){jQuery(n+" ul").append("<li>"+o+"</li>"),jQuery('input[name="'+e+"["+r+']"]').length?(jQuery('input[name="'+e+"["+r+']"]').addClass("opc-error").removeClass("opc-changed"),t||(t=!0,jQuery('input[name="'+e+"["+r+']"]').focus())):(jQuery('select[name="'+e+"["+r+']"]').addClass("opc-error").removeClass("opc-changed"),t||(t=!0,jQuery('select[name="'+e+"["+r+']"]').focus()))})):window.location.reload(!0)})}doesCollectsCardDataOnsite=function(e){return zcLog2Console("Checking doesCollectsCardDataOnsite("+e+") ..."),jQuery("#"+e+"_collects_onsite").val()&&jQuery("#pmt-"+e).is(":checked")?(zcLog2Console("... it does!"),i=e,!0):(zcLog2Console("... it does not."),i=null,!1)},doCollectsCardDataOnsite=function(){var e=jQuery('form[name="checkout_payment"]').serializeArray();zcLog2Console("doCollectsCardDataOnsite for "+i),zcJS.ajax({url:"ajax.php?act=ajaxPayment&method=prepareConfirmation",data:e}).done(function(e){jQuery("#checkoutPayment").hide(),jQuery("#navBreadCrumb").html(e.breadCrumbHtml.replace(/\.ready/g,".ajaxComplete")),jQuery("#checkoutPayment").before(e.confirmationHtml.replace(/\.ready/g,".ajaxComplete")),jQuery(document).attr("title",e.pageTitle),jQuery(document).scrollTop(0),-1==confirmation_required.indexOf(i)?(zcLog2Console('Preparing to submit form, since confirmation is not required for "'+i+'", per the required list: "'+confirmation_required),jQuery("#checkoutOneLoading").show(),jQuery("#checkoutConfirmationDefault").hide(),jQuery(document).ajaxComplete(function(){jQuery('form[name="checkout_confirmation"]')[0].submit()})):(zcLog2Console("Confirmation required, displaying for "+i+"."),jQuery("#checkoutConfirmDefault").show())})},jQuery(document).ajaxStart(function(){jQuery("*").css("cursor","wait")}),jQuery(document).ajaxStop(function(){jQuery("*").css("cursor","")}),jQuery(document).on("change","input[name=shipping]",function(){var e={shipping_selection:jQuery(this).val()};0!=additionalShippingInputs.length&&(jQuery.each(additionalShippingInputs,function(e,o){shippingInputs[e]=jQuery('input[name="'+o.input_name+'"]'+o.parms).val()}),e=jQuery.extend(e,shippingInputs)),zcLog2Console("Updating shipping method to "+jQuery(this).val()),zcJS.ajax({url:"ajax.php?act=ajaxOnePageCheckout&method=updateShippingSelection",data:e,timeout:shippingTimeout,error:function(e,o,t){zcLog2Console("error: status="+o+", errorThrown = "+t+", override: "+e),"timeout"==o&&alert(ajaxTimeoutShippingErrorMessage),shippingError=!0}}).done(function(e){c(e),""!==e.errorMessage?alert(e.errorMessage):(jQuery("#orderTotalDivs").html(e.orderTotalHtml),jQuery("#current-order-total").val(e.total))})}),jQuery(document).on("click","#shipping_billing",function(){jQuery("#shipping_billing").is(":checked")&&zcJS.ajax({url:"ajax.php?act=ajaxOnePageCheckout&method=setShippingEqualBilling",timeout:shippingTimeout,error:function(e,o,t){zcLog2Console("error: status="+o+", errorThrown = "+t+", override: "+e),"timeout"==o&&alert(ajaxTimeoutShippingErrorMessage),shippingError=!0}}).done(function(e){c(e)}),t()}),jQuery(document).on("click",".opc-cc-submit",function(){zcLog2Console("Submitting credit-class request"),setOrderConfirmed(0),jQuery('form[name="checkout_payment"]').submit()}),jQuery(document).on("change","input[name=payment]",function(){r();var e=jQuery("input[name=payment]");e.is(":radio")&&(e=jQuery("input[name=payment]:checked"));var o={payment:e=0==e.length?"":e.val()};zcLog2Console("Updating payment method to "+e),zcJS.ajax({url:"ajax.php?act=ajaxOnePageCheckout&method=updatePaymentMethod",data:o,timeout:shippingTimeout,error:function(e,o,t){zcLog2Console("error: status="+o+", errorThrown = "+t+", override: "+e),"timeout"==o&&alert(ajaxTimeoutPaymentErrorMessage)}}).done(function(e){c(e),jQuery("#orderTotalDivs").html(e.orderTotalHtml),jQuery("#current-order-total").val(e.total)})}),jQuery(document).on("click","#opc-order-review",function(){u("review")}),jQuery(document).on("click","#opc-order-confirm",function(){u("confirm")}),jQuery(document).on("change","#select-address-bill",function(){a("bill",this.value)}),jQuery(document).on("change","#select-address-ship",function(){a("ship",this.value)}),jQuery(document).on("focus","#checkoutOneGuestInfo input, #checkoutOneBillto input, #checkoutOneBillto select:not(#select-address-bill)",s),jQuery(document).on("click","#opc-bill-cancel",l),jQuery(document).on("click","#opc-bill-save",d),jQuery(document).on("click","#opc-bill-edit",function(){jQuery("#address-bill").hide(),jQuery("#address-form-bill").show(),jQuery("#checkoutOneBillto .opc-buttons").show(),jQuery("#opc-bill-save, #opc-add-bill, #opc-add-bill+label").hide()}),jQuery(document).on("click","#opc-ship-edit",function(){jQuery("#address-ship").hide(),jQuery("#address-form-ship").show(),jQuery("#checkoutOneShipto .opc-buttons").show(),jQuery("#opc-ship-save, #opc-add-ship, #opc-add-ship+label").hide()}),jQuery(document).on("focus","#checkoutOneShipto input, #checkoutOneShipto select:not(#select-address-ship)",p),jQuery(document).on("click","#opc-ship-cancel",h),jQuery(document).on("click","#opc-ship-save",m),jQuery("#checkoutPaymentNoJs").hide(),jQuery("#checkoutPayment").show(),jQuery("#checkoutOneGuestInfo").length&&jQuery("#checkoutOneGuestInfo, #checkoutOneBillto").find("input").each(function(){if(jQuery(this).is(":visible")&&jQuery(this).prop("required")&&""==jQuery(this).val())return jQuery("#checkoutOneBillto .opc-buttons").show(),jQuery("#opc-bill-cancel").hide(),jQuery("#checkoutPayment > .opc-overlay").addClass("active"),jQuery("#checkoutOneGuestInfo, #checkoutOneBillto").addClass("opc-view"),jQuery(this).focus(),!1}),jQuery("#opc-need-primary-address").length&&(jQuery("#checkoutOneBillto").find("input").each(function(){if(jQuery(this).is(":visible")&&jQuery(this).prop("required")&&""==jQuery(this).val())return jQuery(this).focus(),!1}),jQuery("#checkoutOneBillto .opc-buttons").show(),jQuery("#opc-bill-cancel, #checkoutOneShippingFlag").hide())});